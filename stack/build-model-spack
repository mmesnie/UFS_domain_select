#!/bin/bash

if [ $# != 1 ]; then
        echo "usage: build-model <2.1.0|2.2.0>"
        exit 1
fi

VER=v$1

export UFS_DOMAIN_SELECT_HOME=$(realpath $(dirname $0))/..

SRC=${UFS_DOMAIN_SELECT_HOME}/build/ufs-srweather-app-$VER

git clone -b release/public-$VER https://github.com/ufs-community/ufs-srweather-app.git $SRC

cd $SRC

./manage_externals/checkout_externals

cp ${UFS_DOMAIN_SELECT_HOME}/stack/patch/config.yaml ush
cp ${UFS_DOMAIN_SELECT_HOME}/stack/patch/devbuild.sh .

./devbuild.sh --platform=foo --compiler=bar

echo
echo "### ADD THIS TO .bashrc ###"
echo 'export LD_LIBRARY_PATH="/home/mmesnie/spack/opt/spack/linux-skylake/jasper-2.0.32-rtkl4gq4motlfphdsabecabljnlin3ts/lib:/home/mmesnie/spack//opt/spack/linux-skylake/netcdf-c-4.9.2-xrs73ogct56pkfrhtqzhh7eix7bmnxzu/lib/:/home/mmesnie//opt/spack/linux-skylake/netcdf-fortran-4.6.0-vjmlso57ad3ndhx74frkk3zlkd3mzbeq/lib:/home/mmesnie/spack/opt/spack/linux-skylake/netcdf-fortran-4.6.0-vjmlso57ad3ndhx74frkk3zlkd3mzbeq/lib/:/home/mmesnie/spack/opt/spack/linux-skylake/parallelio-2.5.10-zue5grdujkeen543zdbtveezhfm2jjul/lib:$LD_LIBRARY_PATH"'
echo "###########################"
echo
