#!/bin/bash

if ! [[ "$0" == "bash" ]] || [[ "$0" == "-bash" ]] || [[ "$0" == "/bin/bash" ]]; then
    echo "Script must be sourced, not executed directly."
    exit 1
fi

cd ~
git clone -c feature.manyFiles=true https://github.com/spack/spack.git
echo "source ~/spack/share/spack/setup-env.sh" >> ~/.bashrc
source ~/spack/share/spack/setup-env.sh

spack env create ufs
spack env activate ufs -p
echo "spack env activate ufs -p" >> ~/.bashrc

echo "\"spack edit fms\" and add these to cmake_args"
echo "args.append(\"-D64BIT:BOOL=ON\")"
echo "args.append(\"-DGFS_PHYS:BOOL=ON\")"
echo "args.append(\"-DOPENMP:BOOL=ON\")"
echo "args.append(\"-DCONSTANTS=GFS\")"

read -p "Enter to continue"

spack compiler find

spack add netcdf-c@4.9.2 netcdf-fortran@4.6.0 parallelio@2.5.10 esmf@8.4.2 bacio@2.4.1 crtm@2.4.0 g2@3.4.5 g2tmpl@1.10.2 nemsio@2.5.4 sfcio@1.4.1 sigio@2.3.2 sp@2.3.3 fms@2023.01 ip@3.3.3 jasper@2.0.32 libpng@1.6.37 jpeg@9.1.0 mapl@2.35.2 ^esmf@8.4.2 wgrib2@2.0.8 w3emc@2.9.2 gftl-shared@1.5.0 w3nco@2.4.1 wrf-io@1.2.0

spack concretize
spack install
